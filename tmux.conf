##### TPM plugins #####
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'seebi/tmux-colors-solarized'
set -g @plugin 'tmux-plugins/tmux-yank'        # portable clipboard & OSC52 fallback

# Initialize TMUX plugin manager (keep at the end)
# but we re-run it at bottom after options too:
# run '~/.tmux/plugins/tpm/tpm'

##### Prefix & basics #####
unbind C-b
set -g prefix C-j
bind C-j send-prefix

set -g mouse on
setw -g mode-keys vi

bind-key R source-file ~/.tmux.conf \; display-message "tmux.conf reloaded."
bind-key L clear-history
bind-key r refresh-client

# splits & pane nav
bind-key v split-window -h
bind-key s split-window -v
bind-key h select-pane -L
bind-key j select-pane -D
bind-key k select-pane -U
bind-key l select-pane -R

# copy mode
bind-key [ copy-mode
bind-key ] paste-buffer
bind-key -T copy-mode-vi v send -X begin-selection

##### Clipboard (portable) #####
# Use tmux-yank defaults (supports OSC52 over SSH).
# But also provide explicit bindings that adapt to macOS / X11 / Wayland.
# Save buffer -> system clipboard
if-shell 'command -v pbcopy >/dev/null 2>&1' \
  "bind-key -T copy-mode-vi y send -X copy-pipe-and-cancel 'pbcopy'" \
  "if-shell 'command -v wl-copy >/dev/null 2>&1' \
     \"bind-key -T copy-mode-vi y send -X copy-pipe-and-cancel 'wl-copy'\" \
     \"if-shell 'command -v xclip >/dev/null 2>&1' \
        \\\"bind-key -T copy-mode-vi y send -X copy-pipe-and-cancel 'xclip -selection clipboard -in'\\\" \
        \\\"bind-key -T copy-mode-vi y send -X copy-selection\\\"\""

# System clipboard -> tmux buffer
if-shell 'command -v pbpaste >/dev/null 2>&1' \
  "bind-key C-p run -b \"tmux set-buffer \\\"\\\$(pbpaste)\\\" ; tmux paste-buffer\"" \
  "if-shell 'command -v wl-paste >/dev/null 2>&1' \
     \"bind-key C-p run -b 'tmux set-buffer \"\\\$(wl-paste)\" ; tmux paste-buffer'\" \
     \"if-shell 'command -v xclip >/dev/null 2>&1' \
        \\\"bind-key C-p run -b 'tmux set-buffer \"\\\$(xclip -o -selection clipboard)\" ; tmux paste-buffer'\\\" \
        \\\"unbind -n C-p\\\"\""

# Optional: quick export of current tmux buffer to system clipboard
if-shell 'command -v pbcopy >/dev/null 2>&1' \
  "bind-key C-y run -b 'tmux save-buffer - | pbcopy'" \
  "if-shell 'command -v wl-copy >/dev/null 2>&1' \
     \"bind-key C-y run -b 'tmux save-buffer - | wl-copy'\" \
     \"if-shell 'command -v xclip >/dev/null 2>&1' \
        \\\"bind-key C-y run -b 'tmux save-buffer - | xclip -selection clipboard'\\\" \
        \\\"unbind -n C-y\\\"\""

##### Noise settings #####
set -g visual-activity off
set -g visual-bell off
set -g visual-silence off
setw -g monitor-activity off
set -g bell-action none

##### Term & colors (portable truecolor) #####
set -g default-terminal "screen-256color"
# truecolor support if terminal advertises Tc
set -ga terminal-overrides ",xterm-256color:Tc,screen-256color:Tc,tmux-256color:Tc"

##### Status bar & styling (modern tmux syntax) #####
set -g status-justify left
set -g status-interval 2
set -g status-position top
set -g status-left-length 20
set -g status-right-length 50

# Replace deprecated pane-border-fg/bg etc. with *-style
set -g pane-border-style fg=black,bg=colour235
set -g pane-active-border-style fg=colour51,bg=colour236

# Messages
set -g message-style fg=colour232,bg=colour81,bold

# Mode (copy/search)
setw -g mode-style fg=colour196,bg=colour238,bold

# Status line baseline
set -g status-style fg=colour137,bg=colour234,dim
set -g status-left ''
set -g status-right '#[fg=colour233,bg=colour241,bold] %d/%m #[fg=colour233,bg=colour245,bold] %H:%M:%S '

# Window status styling
setw -g window-status-style fg=colour138,bg=colour235
setw -g window-status-format ' #I#[fg=colour237]:#[fg=colour250]#W#[fg=colour244]#F '

setw -g window-status-current-style fg=colour81,bg=colour238,bold
setw -g window-status-current-format ' #I#[fg=colour250]:#[fg=colour255]#W#[fg=colour50]#F '

# Alt color set (Solarized dark alignment + your custom)
set -g @colors-solarized 'dark'
set -g status-style fg=yellow,bg=black
set -g pane-border-style fg=black
set -g pane-active-border-style fg=brightgreen
set -g message-style fg=brightred,bg=black
set -g display-panes-active-colour blue
set -g display-panes-colour brightred
setw -g clock-mode-colour green
setw -g window-status-bell-style fg=black,bg=red

##### Activity / titles #####
setw -g automatic-rename on
set -g set-titles on

##### Extra (optional) #####
# Clear duplication of old options/overrides by ensuring final styles win.
# Place any site-specific tweaks below.

##### TPM bootstrap #####
# If TPM is missing, clone it (useful on fresh clusters).
if-shell '[ ! -d ~/.tmux/plugins/tpm ]' \
  'run -b "git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm"'

# Load TPM
run '~/.tmux/plugins/tpm/tpm'

